import{visit as e}from"graphql/language/visitor";import{Kind as t}from"graphql/language/kinds";import{print as r}from"graphql/language/printer";import{parse as n}from"graphql/language/parser";import{GraphQLError as o}from"graphql/error/GraphQLError";import{share as i,onPush as a,takeWhile as u,toPromise as c,take as s,filter as f,map as p,tap as l,merge as h,mergeMap as y,takeUntil as d,make as v,switchMap as m,fromValue as g,interval as x,makeSubject as O,publish as k,onStart as b,onEnd as q,subscribe as w}from"wonka";function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e){return"string"==typeof e?new o(e):"object"==typeof e&&e.message?new o(e.message,e.nodes,e.source,e.positions,e.path,e,e.extensions||{}):e}function _(){return this.message}var S=function(e){function t(t){var r=t.networkError,n=t.response,o=function(e,t){var r="";return void 0!==e?r="[Network] "+e.message:(void 0!==t&&t.forEach((function(e){r+="[GraphQL] "+e.message+"\n"})),r.trim())}(r,t=(t.graphQLErrors||[]).map(N));e.call(this,o),this.name="CombinedError",this.message=o,this.graphQLErrors=t,this.networkError=r,this.response=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=_,t}(Error);function j(e,t){e|=0;for(var r=0,n=0|t.length;r<n;r++)e=(e<<5)+e+t.charCodeAt(r);return e}var P=new Set,A=new WeakMap;function Q(e){return P.clear(),function e(t){if(null===t||P.has(t))return"null";if("object"!=typeof t)return JSON.stringify(t)||"";if(t.toJSON)return t.toJSON();if(Array.isArray(t)){for(var r="[",n=0,o=t.length;n<o;n++){0<n&&(r+=",");var i=e(t[n]);r+=0<i.length?i:"null"}return r+"]"}if(!(r=Object.keys(t).sort()).length&&t.constructor&&t.constructor!==Object)return r=A.get(t)||Math.random().toString(36).slice(2),A.set(t,r),'{"__key":"'+r+'"}';for(P.add(t),n="{",o=0,i=r.length;o<i;o++){var a=r[o],u=e(t[a]);u&&(1<n.length&&(n+=","),n+=e(a)+":"+u)}return P.delete(t),n+"}"}(e)}var R=Object.create(null);function C(e,t){if("string"==typeof e){var o=j(5381,e.replace(/[\s,]+/g," ").trim())>>>0;e=void 0!==R[o]?R[o]:n(e)}else void 0!==e.__key?o=e.__key:(o=j(5381,r(e).replace(/[\s,]+/g," ").trim())>>>0,e=void 0!==R[o]?R[o]:e);return R[o]=e,e.__key=o,{key:t?j(o,Q(t))>>>0:o,query:e,variables:t||{}}}function L(e,t){return E({},e,{context:E({},e.context,{meta:E({},e.context.meta,t)})})}function I(e,t,r){return{operation:e,data:t.data,error:Array.isArray(t.errors)?new S({graphQLErrors:t.errors,response:r}):void 0,extensions:"object"==typeof t.extensions&&t.extensions||void 0}}function M(e,t,r){return{operation:e,data:void 0,error:new S({networkError:t,response:r}),extensions:void 0}}function T(e,t){if(void 0===t&&(t=[]),Array.isArray(e))e.forEach((function(e){T(e,t)}));else if("object"==typeof e&&null!==e)for(var r in e)"__typename"===r&&"string"==typeof e[r]?t.push(e[r]):T(e[r],t);return t}function G(e,t,r){return r.indexOf(e)===t}function D(e){return e.kind===t.FIELD&&"__typename"===e.name.value}function $(e){if(e.selectionSet&&!e.selectionSet.selections.some(D))return e.selectionSet.selections.push({kind:t.FIELD,name:{kind:t.NAME,value:"__typename"}}),e}function F(t){return e(t,{Field:$,InlineFragment:$})}function J(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,r){var n=e[r];return"__typename"===r?Object.defineProperty(t,"__typename",{enumerable:!1,value:n}):t[r]=Array.isArray(n)?n.map(J):n&&"object"==typeof n&&"__typename"in n?J(n):n,t}),{}):e}function U(e){return e.toPromise=function(){return c(s(1)(e))},e}function V(e){return"subscription"!==(e=e.operationName)&&"query"!==e}function W(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}function z(e){return"mutation"!==(e=e.operationName)&&"query"!==e}function B(e){return E({},e,{query:F(e.query)})}function H(e){return"query"!==e.operationName||"cache-only"!==e.context.requestPolicy}function K(e){return L(e,{cacheOutcome:"miss"})}function X(e){return z(e)}function Y(e){function t(e){var t=e.context.requestPolicy;return"query"===e.operationName&&"network-only"!==t&&("cache-only"===t||s.has(e.key))}function r(e){var t=s.get(e.key);return t=E({},t,{operation:L(e,{cacheOutcome:t?"hit":"miss"})}),"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,Z(c,e)),t}function n(e){return!z(e)&&t(e)}function o(e){e.operation&&"mutation"===e.operation.operationName?y(e):e.operation&&"query"===e.operation.operationName&&d(e)}function a(e){return!z(e)&&!t(e)}var u=e.forward,c=e.client,s=new Map;e=Object.create(null);var y=function(e,t,r){function n(t){if(e.has(t)){var n=e.get(t).operation;e.delete(t),Z(r,n)}}return function(e){function r(e){o.add(e)}var o=new Set,i=e.operation.context.additionalTypenames;T(e.data).filter(G).concat(i||[]).forEach((function(e){(e=t[e]||(t[e]=new Set)).forEach(r),e.clear()})),o.forEach(n)}}(s,e,c),d=function(e,t){return function(r){var n=r.operation,o=r.data,i=n.context.additionalTypenames;null!=o&&(e.set(n.key,{operation:n,data:o,error:r.error}),T(r.data).filter(G).concat(i||[]).forEach((function(e){(t[e]||(t[e]=new Set)).add(n.key)})))}}(s,e);return function(e){var t=i(e);return e=p(r)(f(n)(t)),t=l(o)(u(f(H)(p(K)(h([p(B)(f(a)(t)),f(X)(t)]))))),h([e,t])}}function Z(e,t){return e.reexecuteOperation(E({},t,{context:E({},t.context,{requestPolicy:"network-only"})}))}function ee(e){function t(e){o.delete(e.operation.key)}function r(e){var t=e.key;return"teardown"===(e=e.operationName)?(o.delete(t),!0):"query"!==e&&"subscription"!==e||(e=o.has(t),o.add(t),!e)}var n=e.forward,o=new Set;return function(e){return e=f(r)(e),l(t)(n(e))}}function te(e){return"query"===e.operationName||"mutation"===e.operationName}function re(e){return"query"!==e.operationName&&"mutation"!==e.operationName}function ne(e){var t=e.forward;return function(e){var n=i(e);e=y((function(e){var t=e.key,o=f((function(e){return"teardown"===e.operationName&&e.key===t}))(n);return d(o)(function(e,t){return v((function(n){var o=n.next,i=n.complete,a="undefined"!=typeof AbortController?new AbortController:void 0;n="function"==typeof(n=e.context).fetchOptions?n.fetchOptions():n.fetchOptions||{};var u=function(e){return(e=e.definitions.find(oe))?e.name.value:null}(e.query),c={query:r(e.query),variables:e.variables};null!==u&&(c.operationName=u);var s=E({},n,{body:t?void 0:JSON.stringify(c),method:t?"GET":"POST",headers:E({},{"content-type":"application/json"},n.headers),signal:void 0!==a?a.signal:void 0});t&&(e.context.url=function(e,t){var r=["query="+encodeURIComponent(t.query)];return t.variables&&r.push("variables="+encodeURIComponent(JSON.stringify(t.variables))),e+"?"+r.join("&")}(e.context.url,c));var f=!1;return Promise.resolve().then((function(){return f?void 0:function(e,t){var r,n=e.context,o=!1;return(n.fetch||fetch)(n.url,t).then((function(e){return r=e,o=200>e.status||e.status>=("manual"===t.redirect?400:300),e.json()})).then((function(t){if(!("data"in t)&&!("errors"in t))throw Error("No Content");return I(e,t,r)})).catch((function(t){if("AbortError"!==t.name)return M(e,o?Error(r.statusText):t,r)}))}(e,s)})).then((function(e){f||(f=!0,e&&o(e),i())})),function(){f=!0,void 0!==a&&a.abort()}}))}(e,"query"===e.operationName&&!!e.context.preferGetMethod))}))(f(te)(n));var o=t(f(re)(n));return h([e,o])}}function oe(e){return e.kind===t.OPERATION_DEFINITION&&e.name}function ie(){return!1}function ae(){}function ue(e){return f(ie)(l(ae)(e))}function ce(e){return 1===e.length?e[0]:function(t){return e.reduceRight((function(e,r){return r({client:t.client,forward:e})}),t.forward)}}var se=[ee,Y,ne];function fe(e){var t=this;this.activeOperations=Object.create(null),this.queue=[],this.createOperationContext=function(e){return E({},{url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch,preferGetMethod:t.preferGetMethod},e,{requestPolicy:(e||{}).requestPolicy||t.requestPolicy})},this.createRequestOperation=function(e,r,n){return{key:r.key,query:r.query,variables:r.variables,operationName:e,context:t.createOperationContext(n)}},this.reexecuteOperation=function(e){0<(t.activeOperations[e.key]||0)&&(t.queue.push(e),t.dispatchOperation())},this.executeQuery=function(e,r){e=t.createRequestOperation("query",e,r);var n=t.executeRequestOperation(e);return(e=e.context.pollInterval)?m((function(){return n}))(h([g(0),x(e)])):n},this.executeSubscription=function(e,r){return e=t.createRequestOperation("subscription",e,r),t.executeRequestOperation(e)},this.executeMutation=function(e,r){return e=t.createRequestOperation("mutation",e,r),t.executeRequestOperation(e)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var r=O(),n=r.next;this.operations$=r.source;var o=!1;this.dispatchOperation=function(e){if(o)e&&n(e);else{for(o=!0,e&&n(e);e=t.queue.shift();)n(e);o=!1}},e=ce(void 0!==e.exchanges?e.exchanges:se),this.results$=i(e({client:this,forward:ue})(this.operations$)),k(this.results$)}function pe(e){return e.data=J(e.data),e}function le(e){return new fe(e)}function he(e){var t=e.forward;return function(e){return t(e)}}function ye(e){function t(t){var r=t.client,s=t.forward;return function(t){var y=e&&"boolean"==typeof e.isClient?!!e.isClient:!r.suspense,d=i(t);return t=s(f(n)(d)),d=p(o)(f(a)(d)),y?d=l(c)(d):t=l(u)(t),h([t,d])}}function r(e){return!V(e)&&void 0!==s[e.key]}function n(e){return!r(e)}function o(e){var t=s[e.key],r=t.error;return{operation:e,data:t.data,extensions:void 0,error:r?new S({networkError:r.networkError?Error(r.networkError):void 0,graphQLErrors:r.graphQLErrors&&r.graphQLErrors.length?r.graphQLErrors:void 0}):void 0}}function a(e){return r(e)}function u(e){var t=e.operation;if(!V(t)){var r=e.error;e={data:e.data,error:void 0},r&&(e.error={graphQLErrors:r.graphQLErrors.map(W),networkError:r.networkError?""+r.networkError:void 0}),s[t.key]=e}}function c(e){delete s[e.operation.key]}var s={};return t.restoreData=function(e){return E(s,e)},t.extractData=function(){return E({},s)},e&&e.initialState&&t.restoreData(e.initialState),t}function de(e){function t(e){return"subscription"===(e=e.operationName)||!!o&&("query"===e||"mutation"===e)}var n=e.forwardSubscription,o=e.enableAllOperations;return function(e){function o(e){var t=n({key:e.key.toString(36),query:r(e.query),variables:e.variables,context:E({},e.context)});return v((function(r){function n(t){return c(I(e,t))}function o(t){return c(M(e,t))}function i(){f||(f=!0,"subscription"===e.operationName&&u.reexecuteOperation(E({},e,{operationName:"teardown"})),s())}var a,c=r.next,s=r.complete,f=!1;return Promise.resolve().then((function(){f||(a=t.subscribe({next:n,error:o,complete:i}))})),function(){f=!0,a&&a.unsubscribe()}}))}function a(e){return!s(e)}var u=e.client,c=e.forward,s=t;return function(e){var t=i(e);e=y((function(e){var r=e.key,n=f((function(e){return"teardown"===e.operationName&&e.key===r}))(t);return d(n)(o(e))}))(f(s)(t));var r=c(f(a)(t));return h([e,r])}}}fe.prototype.onOperationStart=function(e){var t=e.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(e)},fe.prototype.onOperationEnd=function(e){var t=e.key,r=this.activeOperations[t]||0;0>=(this.activeOperations[t]=0>=r?0:r-1)&&this.dispatchOperation(E({},e,{operationName:"teardown"}))},fe.prototype.executeRequestOperation=function(e){var t=this,r=e.key,n=e.operationName,o=f((function(e){return e.operation.key===r}))(this.results$);if(this.maskTypename&&(o=p(pe)(o)),"mutation"===n)return s(1)(b((function(){return t.dispatchOperation(e)}))(o));var l=f((function(e){return"teardown"===e.operationName&&e.key===r}))(this.operations$);return o=q((function(){t.onOperationEnd(e)}))(b((function(){t.onOperationStart(e)}))(d(l)(o))),!1!==e.context.suspense&&this.suspense&&"query"===n?function(e){return function(t){var r=i(e),n=!1,o=!1;if(a((function(){return n=!0}))(u((function(){return!o}))(r))(t),!n)throw o=!0,t(0),c(s(1)(r))}}(o):o},fe.prototype.query=function(e,t,r){return r&&"boolean"==typeof r.suspense||(r=E({},r,{suspense:!1})),U(this.executeQuery(C(e,t),r))},fe.prototype.readQuery=function(e,t,r){var n=null;return w((function(e){n=e}))(this.executeQuery(C(e,t),r)).unsubscribe(),n},fe.prototype.mutation=function(e,t,r){return U(this.executeMutation(C(e,t),r))};export{fe as Client,S as CombinedError,Y as cacheExchange,ce as composeExchanges,le as createClient,C as createRequest,he as debugExchange,ee as dedupExchange,se as defaultExchanges,ue as fallbackExchangeIO,ne as fetchExchange,F as formatDocument,M as makeErrorResult,I as makeResult,J as maskTypename,ye as ssrExchange,Q as stringifyVariables,de as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
